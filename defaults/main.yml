---

role_action: provision

env: test

instance_timeout: 600

instance_wait_retry_limit: 300
instance_wait_connection_timeout: 600

pause_in_seconds: 60

deploy_async: false

wait_for_connection: true

# Optional OpenStack config vars file (commonly used to set OS_CLIENT_CONFIG_FILE/OS_CLOUD).
# If set, we validate it exists during preflight for early failure,
# mirroring ansible-role-os-stack.
config_file: "{{ lookup('env', 'OS_CLIENT_CONFIG_FILE') }}"

# SSL verification for OpenStack API calls (default: enabled). Molecule scenarios can override.
# If OS_INSECURE is set (1/true/yes/on), we disable cert validation to match
# common OpenStack client behavior.
openstack_validate_certs: >-
  {{
    not (
      (lookup('env', 'OS_INSECURE') | default('false', true) | string | lower)
      in ['1', 'true', 'yes', 'y', 'on']
    )
  }}

# If true, attempt a best-effort cleanup (deprovision) when provision fails.
openstack_deprovision_best_effort: false

set_network_to_private: >-
  ([Activator]::CreateInstance([Type]::GetTypeFromCLSID(
  [Guid]"{DCB00C01-570F-4A9B-8D69-199FDBA5723B}"))).GetNetworkConnections() | % {$_.GetNetwork().SetCategory(1)}

# Reference Windows WinRM enablement script used by some workflows/tests.
winrm_enable_script_url: https://raw.githubusercontent.com/ansible/ansible-documentation/devel/examples/scripts/ConfigureRemotingForAnsible.ps1
